dependencies:
  cache_directories:
    - "~/.meteor"

  override:
    - meteor || curl https://install.meteor.com | /bin/sh
    - meteor --version
    - npm -version
    - node -v

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) cd app &&  CUCUMBER_TAGS='@server1' meteor --test --once --settings ../config/development/settings.json ;; 1) cd app && CUCUMBER_TAGS='@server1' meteor --test --once --setting ../config/development/settings.json ;; esac: 
        parallel: true

deployment:
  production:
    branch: master
    commands:
      - cd app && meteor build ../build/
      - cd build && scp app.tar.gz root@bojica.com:~ && ssh root@bojica.com 'cd /root && ./deploy.sh'
